{"version":3,"file":"js-egov-authentication.js","sources":["../../../modules/js-egov-authentication/src/egov-authentication.ts","../../../modules/js-egov-authentication/src/egovauth.ts","../../../modules/js-egov-authentication/src/environmentDetector.ts","../../../modules/js-egov-authentication/src/authenticationUrls.ts","../../../modules/js-egov-authentication/src/httpBackend.ts","../../../modules/js-egov-authentication/src/user.ts","../../../modules/js-egov-authentication/src/authSession.ts","../../../modules/js-egov-authentication/src/httpHandler.ts","../../../modules/js-egov-authentication/src/ui.service.ts","../../../modules/js-egov-authentication/src/localizations.ts","../../../modules/js-egov-authentication/src/polyfills.ts"],"sourcesContent":["// import 'core-js/es6/object';\r\n\r\nexport * from './egovauth';\r\nexport * from './authSession';\r\nexport * from './authenticationUrls';\r\nexport * from './egovAuthConfiguration.interface';\r\nexport * from './user';\r\nexport * from './localizations';\r\nexport * from './models/userProperties';\r\n","import { UserProperties } from './models/userProperties';\r\nimport { EgovAuthConfiguration } from './egovAuthConfiguration.interface';\r\nimport { AuthSession } from './authSession';\r\nimport { User } from './user';\r\nimport { HttpBackend } from './httpBackend';\r\nimport { XHRResponse, XHRRequest } from './models/xhr';\r\nimport { AuthenticationUrls } from './authenticationUrls';\r\nimport { EnvironmentDetector } from './environmentDetector';\r\nimport { HttpHandler } from './httpHandler';\r\n\r\nexport class Authentication {\r\n  static isConfigured: boolean;\r\n  private static configuration: EgovAuthConfiguration;\r\n  private static authSession: AuthSession;\r\n  private static authUrls: AuthenticationUrls;\r\n  private static sessionCreatedCb: Function;\r\n\r\n  /**\r\n\t * Configure the authentication library with the different available options\r\n\t *\r\n\t * @param {EgovAuthConfiguration} configuration The configuration options\r\n\t */\r\n  static configure(configuration: EgovAuthConfiguration) {\r\n    Authentication.isConfigured = true;\r\n    Authentication.configuration = configuration;\r\n\r\n    let envDetector = new EnvironmentDetector(configuration.environment, configuration.isHttps);\r\n    this.authUrls = new AuthenticationUrls(envDetector, configuration);\r\n  }\r\n\r\n  static isAuthenticated() {\r\n    return Authentication.authSession && Authentication.authSession.isAuthenticated;\r\n  }\r\n\r\n  /**\r\n\t * Returns the authentication configuration\r\n\t */\r\n  static getConfiguration() {\r\n    return Authentication.configuration;\r\n  }\r\n\r\n  static onSessionCreated(cb: Function) {\r\n    this.sessionCreatedCb = cb;\r\n  }\r\n\r\n  static getAuthSession() {\r\n    return this.authSession;\r\n  }\r\n\r\n  static handleAjaxResponse(xhr: XHRResponse) {\r\n    const config = Authentication.configuration;\r\n    HttpHandler.handleAjaxResponse(config, xhr);\r\n  }\r\n\r\n  static getUrls() {\r\n    return this.authUrls;\r\n  }\r\n\r\n  static getCurrent(options?: any) /*: Promise<User>*/ {\r\n    // cannot add Promise as it causes compilation errors in jsui -> try later\r\n    if (!Authentication.isConfigured) {\r\n      throw new Error('Not configured, please invoke .configure(..) first');\r\n    }\r\n\r\n    if (!Authentication.configuration.httpLibrary) {\r\n      throw new Error('No ajax library configured. Set the according property \"httpLibrary\"');\r\n    }\r\n\r\n    let httpBackend = new HttpBackend(Authentication.configuration.httpLibrary);\r\n\r\n    let ajaxOptions = (<any>Object).assign(\r\n      {},\r\n      {\r\n        url: this.getUrls().getCurrentUserUrl(),\r\n        method: 'GET'\r\n      },\r\n      options\r\n    );\r\n\r\n    return httpBackend.execute(ajaxOptions).then((userProps: UserProperties) => {\r\n      const user = new User(userProps);\r\n      Authentication.authSession = new AuthSession(\r\n        user,\r\n        Authentication.configuration,\r\n        this.authUrls,\r\n        httpBackend\r\n      );\r\n\r\n      if (this.sessionCreatedCb) {\r\n        this.sessionCreatedCb(Authentication.authSession);\r\n      }\r\n\r\n      return user;\r\n    });\r\n  }\r\n\r\n  /**\r\n\t * Manually initialize a new session by simply passing in the user object\r\n\t */\r\n  static initWithUser(user: UserProperties) {\r\n    if (!Authentication.isConfigured) {\r\n      throw new Error('Not configured, please invoke .configure(..) first');\r\n    }\r\n\r\n    let httpBackend = new HttpBackend(Authentication.configuration.httpLibrary);\r\n\r\n    Authentication.authSession = new AuthSession(\r\n      new User(user),\r\n      Authentication.configuration,\r\n      this.authUrls,\r\n      httpBackend\r\n    );\r\n  }\r\n}\r\n","import { EnvironmentPrefix } from './environmentPrefix';\r\n\r\nexport interface IEnvironmentDetector {\r\n    getEnvironmentPrefix(): EnvironmentPrefix;\r\n    getProtocol(): string;\r\n    getCurrentWindowUrl(): string;\r\n}\r\n\r\nexport class EnvironmentDetector implements IEnvironmentDetector {\r\n    private envPrefix: EnvironmentPrefix;\r\n\tprivate protocol: string = 'https';\r\n\r\n    constructor(prefix?: EnvironmentPrefix, isHttps?: boolean) {\r\n        if(prefix) {\r\n            this.envPrefix = prefix;\r\n        }\r\n\r\n        if(isHttps === false) {\r\n            this.protocol = 'http';\r\n        } \r\n    }\r\n\r\n    /**\r\n     * Returns the current environment prefix, which is either 'dev', 'test', 'demo', 'prod'.\r\n     */\r\n    getEnvironmentPrefix(): EnvironmentPrefix {\r\n        let environment:EnvironmentPrefix = ''; // equals to prod\r\n        \r\n        if(this.envPrefix) {\r\n            environment = this.envPrefix;\r\n        } else {\r\n            let url = this.getCurrentWindowUrl();\r\n            \r\n            if (url.indexOf('dev') !== -1 || url.indexOf('localhost') !== -1) {\r\n                environment = 'dev';\r\n            }\r\n            if (url.indexOf('test') !== -1) {\r\n                environment = 'test';\r\n            }\r\n            if (url.indexOf('demo') !== -1) {\r\n                environment = 'demo';\r\n            }\r\n        }\r\n\r\n        return environment;\r\n    }\r\n\r\n    /**\r\n     * Returns the current \r\n     */\r\n    getProtocol(): string {\r\n        let protocol;\r\n        if(this.protocol) {\r\n            protocol = this.protocol;\r\n        } else {\r\n            let tmpProtocol = (window && window.location.protocol);\r\n            // we get 'https:', or 'http:' and should get rid of the colon\r\n\r\n            if(tmpProtocol) {\r\n                protocol = tmpProtocol.replace(':', '');\r\n            }\r\n        }\r\n\r\n        return protocol;\r\n    }\r\n\r\n    /**\r\n     * Returns the current url.\r\n     */\r\n    getCurrentWindowUrl():string {\r\n        return window.location.href;\r\n    }\r\n\r\n}\r\n","import { EgovAuthConfiguration, UrlConfigFunc } from './egovAuthConfiguration.interface';\r\nimport { IEnvironmentDetector } from './environmentDetector';\r\nimport { EnvironmentPrefix } from \"./environmentPrefix\";\r\n\r\nexport class AuthenticationUrls {\r\n\tprivate apiPrefix:string = '/iamauth';\r\n\tprivate protocol: string = 'https';\r\n\r\n\tconstructor(private envDetector:IEnvironmentDetector, private egovConfig?: EgovAuthConfiguration) {\r\n\t\tif(!envDetector) {\r\n\t\t\tthrow 'You have to pass in a valid class that implements the IEnvironmentDetector interface.';\r\n\t\t}\r\n\r\n\t\t// set default api prefix to emptystring\r\n\t\tif(egovConfig) {\r\n\t\t\tlet prefix = this._resolveString(egovConfig.apiPrefix);\r\n\t\t\tif(prefix !== null) {\r\n\t\t\t\tthis.apiPrefix = prefix;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.protocol = envDetector.getProtocol();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the url for fetching the user\r\n\t */\r\n\tpublic getCurrentUserUrl():string {\r\n\t\tif (this.egovConfig) {\r\n\t\t\tconst config = this._resolveString(this.egovConfig.userUrl);\r\n\t\t\tif(config !== null) {\r\n\t\t\t\treturn config;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn `${this.apiPrefix}/user/current`;\r\n\t}\r\n\r\n\t/**\r\n\t * Get the url of the login page\r\n\t * @param backUrl - the url to redirect back to again\r\n\t */\r\n\tpublic getLoginPageUrl(backUrl?:string) {\r\n\t\tif (this.egovConfig) {\r\n\t\t\tconst config = this._resolveString(this.egovConfig.loginUrl);\r\n\t\t\tif(config !== null) {\r\n\t\t\t\treturn config;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(!backUrl) {\r\n\t\t\tbackUrl = this.envDetector.getCurrentWindowUrl();\r\n\t\t}\r\n\r\n\t\treturn `${this.apiPrefix}/login?target=${encodeURIComponent(backUrl)}`;\r\n\t}\r\n\r\n\tpublic getLogoutPageUrl(backUrl?:string) {\r\n\t\tif (this.egovConfig) {\r\n\t\t\tconst config = this._resolveString(this.egovConfig.logoutUrl);\r\n\t\t\tif (config !== null) {\r\n\t\t\t\treturn config;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(!backUrl) {\r\n\t\t\tbackUrl = this.envDetector.getCurrentWindowUrl();\r\n\t\t}\r\n\r\n\t\treturn `${this.apiPrefix}/logout?target=${encodeURIComponent(backUrl)}`;\r\n\t}\r\n\t\r\n\t/**\r\n\t * returns the url pointing to the profile homepage, where the user can see\r\n\t * and modify his profile.\r\n\t */\r\n\tpublic getProfilePageUrl() {\r\n\t\tif (this.egovConfig) {\r\n\t\t\tconst config = this._resolveString(this.egovConfig.myProfileUrl);\r\n\t\t\tif(config !== null) {\r\n\t\t\t\treturn config;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet envPrefix:EnvironmentPrefix = this.envDetector.getEnvironmentPrefix();\r\n\t\tif(envPrefix !== '') {\r\n\t\t\tenvPrefix += '-';\r\n\t\t}\r\n\r\n\t\treturn `${this.protocol}://${envPrefix}iam.civis.bz.it/api/appurls/MyProfile`;\r\n\t}\r\n\r\n\tpublic getNewDelegationRequestUrl(backUrl?:string) {\r\n\t\tif(this.egovConfig) {\r\n\t\t\tconst config = this._resolveString(this.egovConfig.newDelegationUrl);\r\n\t\t\tif(config !== null) {\r\n\t\t\t\treturn config;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(!backUrl) {\r\n\t\t\tbackUrl = this.envDetector.getCurrentWindowUrl();\r\n\t\t}\r\n\r\n\t\treturn `${this.apiPrefix}/requestDelegation?target=${encodeURIComponent(backUrl)}`;\r\n\t}\r\n\r\n\tpublic getChangeDelegationUrl() {\r\n\t\tif(this.egovConfig) {\r\n\t\t\tconst config = this._resolveString(this.egovConfig.changeDelegationUrl);\r\n\t\t\tif(config !== null) {\r\n\t\t\t\treturn config;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn `${this.apiPrefix}/user/current`;\r\n\t}\r\n\t\r\n\tpublic getAccessDataUrl() {\r\n\t\tlet envPrefix:EnvironmentPrefix = this.envDetector.getEnvironmentPrefix();\r\n\t\tif(envPrefix !== '') {\r\n\t\t\tenvPrefix += '-';\r\n\t\t}\r\n\r\n\t\treturn `${this.protocol}://${envPrefix}iam.civis.bz.it/api/appurls/MyCredentials`;\r\n\t}\r\n\r\n\tpublic getDelegationsUrl() {\r\n\t\tlet envPrefix:EnvironmentPrefix = this.envDetector.getEnvironmentPrefix();\r\n\t\tif(envPrefix !== '') {\r\n\t\t\tenvPrefix += '-';\r\n\t\t}\r\n\r\n\t\treturn `${this.protocol}://${envPrefix}iam.civis.bz.it/api/appurls/MyDelegations`;\r\n\t}\r\n\r\n\tpublic getCurrentDelegationProfileUrl() {\r\n\t\tlet envPrefix:EnvironmentPrefix = this.envDetector.getEnvironmentPrefix();\r\n\t\tif(envPrefix !== '') {\r\n\t\t\tenvPrefix += '-';\r\n\t\t}\r\n\r\n\t\treturn `${this.protocol}://${envPrefix}iam.civis.bz.it/api/appurls/CurrentDelegationProfile`;\r\n\t}\r\n\r\n\tpublic getRepresentativesUrl() {\r\n\t\tlet envPrefix:EnvironmentPrefix = this.envDetector.getEnvironmentPrefix();\r\n\t\tif(envPrefix !== '') {\r\n\t\t\tenvPrefix += '-';\r\n\t\t}\r\n\r\n\t\treturn `${this.protocol}://${envPrefix}iam.civis.bz.it/api/appurls/CurrentDelegationRepresentatives`;\r\n\t}\r\n\r\n\tprivate _resolveString(param: string | UrlConfigFunc): string {\r\n\t\tif(param) {\r\n\t\t\tif(typeof param === 'function') {\r\n\t\t\t\treturn param(this.envDetector.getEnvironmentPrefix());\r\n\t\t\t} else {\r\n\t\t\t\t// must be a string\r\n\t\t\t\treturn param;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","import { User } from './user';\r\nimport { HttpLibraryFunc } from './egovAuthConfiguration.interface';\r\n\r\nexport class HttpBackend {\r\n  constructor(private ajaxLib: HttpLibraryFunc) {}\r\n\r\n  execute(ajaxOptions) {\r\n    return this.ajaxLib(ajaxOptions).then(userObject => {\r\n      var resultObj = userObject;\r\n\r\n      // watch out, if the actual response data is wrapped inside\r\n      // the data property (i.e. with Angular's $http)\r\n      if (userObject.data) {\r\n        resultObj = userObject.data;\r\n      }\r\n      return new User(resultObj);\r\n    });\r\n  }\r\n}\r\n","import { Delegation } from './models/delegation';\r\nimport { Owner } from './models/owner';\r\nimport { SessionInfo } from './models/sessionInfo';\r\nimport { Accreditation } from './models/accreditation';\r\nimport { UserProperties } from './models/userProperties';\r\nimport { AuthLanguageCode } from \"./localizations\";\r\n\r\nexport interface UserRole {\r\n\trole: string;\r\n\tfunctions: string[];\r\n}\r\n\r\nexport class User {\r\n\tpublic owner: Owner;\r\n\tpublic username: string;\r\n\tpublic language:AuthLanguageCode;\r\n\tpublic sessionInfo: SessionInfo;\r\n\t// public ownerId: number;\r\n\t// public roles: UserRole[];\r\n\t// public functions: string[];\r\n\tpublic delegations: Delegation[];\r\n\tpublic currentAccreditations: Accreditation[];\r\n\r\n\tconstructor(\r\n\t\tproperties: UserProperties\r\n\t) {\r\n\t\tif (properties) {\r\n\r\n\t\t\t// copy properties over\r\n\t\t\tfor (let key in properties) {\r\n\t\t\t\tif (properties.hasOwnProperty(key)) {\r\n\t\t\t\t\tthis[key] = properties[key];\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// if (properties.roles) {\r\n\t\t\t// \tthis.roles = properties.roles;\r\n\t\t\t// \tthis.functions = getDistinctFunctions(properties.roles);\r\n\t\t\t// }\r\n\t\t}\r\n\r\n\t\tthis.delegations = this.delegations || [];\r\n\t}\r\n\r\n\tget displayName() : string {\r\n\t\tif (this.owner && this.owner.firstname && this.owner.lastname) {\r\n            return `${this.owner.firstname} ${this.owner.lastname}`;\r\n        } else {\r\n            return this.username;\r\n        }\r\n\t}\r\n\r\n\tget activeDelegation(): Delegation {\r\n\t\tfor (var i = 0; i < this.delegations.length; i++) {\r\n\t\t\tif (this.sessionInfo && this.delegations[i].represented.id === this.sessionInfo.currentRepresentedId) {\r\n\t\t\t\treturn this.delegations[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// HACK\r\n\t_dummyValue; // to prevent being optimized out\r\n\tset isAuthenticated(value) {\r\n\t\t// just a dummy one...as we ignore the isAuthenticated property from the server\r\n\t\tthis._dummyValue = value;\r\n\t}\r\n\tget isAuthenticated():boolean {\r\n\t\treturn this.sessionInfo !== null && typeof(this.sessionInfo) !== 'undefined';\r\n\t}\r\n\r\n\thasRole(name: string): boolean {\r\n\t\tif(this.currentAccreditations) {\r\n\t\t\tfor(let accreditation of this.currentAccreditations) {\r\n\t\t\t\tif(accreditation.qualification && accreditation.qualification.uid === name) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetDelegation(id: number):Delegation {\r\n\t\tif (this.delegations) {\r\n\t\t\tlet foundDelegation = null;\r\n\r\n\t\t\tthis.delegations.forEach(delegation => {\r\n\t\t\t\tif (delegation.represented.id === id) {\r\n\t\t\t\t\t// we found the delegation\r\n\t\t\t\t\tfoundDelegation = delegation;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn foundDelegation;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\thasDelegationChanged(newRepresentedId: number) {\r\n\t\treturn this.sessionInfo.currentRepresentedId !== newRepresentedId;\r\n\t}\r\n\r\n}\r\n","import { AuthenticationUrls } from './authenticationUrls';\r\nimport { User } from './user';\r\nimport { HttpBackend } from './httpBackend';\r\nimport { EgovAuthConfiguration } from './egovAuthConfiguration.interface';\r\nimport { XHRResponse, XHRRequest } from './models/xhr';\r\nimport { UIService } from './ui.service';\r\nimport { HttpHandler } from './httpHandler';\r\n\r\nexport class AuthSession {\r\n  private sessionAuthenticated: boolean = false;\r\n  private REDIRECTURL_PLACEHOLDER: string = '{URLENCODED_TARGET}';\r\n  private userInterfaceService: UIService;\r\n\r\n  constructor(\r\n    private user: User,\r\n    private egovAuthOptions: EgovAuthConfiguration,\r\n    private authUrls: AuthenticationUrls,\r\n    private httpBackend: HttpBackend\r\n  ) {\r\n    // set defaults\r\n    this.egovAuthOptions = egovAuthOptions || <EgovAuthConfiguration>{};\r\n    // this.egovAuthOptions.changeDelegationUrl = egovAuthOptions.changeDelegationUrl || this.egovAuthOptions.userUrl;\r\n\r\n    this.sessionAuthenticated = user.isAuthenticated;\r\n    this.userInterfaceService = new UIService(user, egovAuthOptions);\r\n  }\r\n\r\n  get uiService() {\r\n    return this.userInterfaceService;\r\n  }\r\n\r\n  get isAuthenticated() {\r\n    return this.sessionAuthenticated;\r\n  }\r\n\r\n  public changeDelegation(newRepresentedId) {\r\n    if (\r\n      this.egovAuthOptions &&\r\n      this.egovAuthOptions.events &&\r\n      this.egovAuthOptions.events.changeDelegation\r\n    ) {\r\n      // user has full control, has to do the callback himself\r\n      let delegation = this.user.getDelegation(parseInt(newRepresentedId));\r\n      if (delegation) {\r\n        return this.egovAuthOptions.events.changeDelegation(delegation);\r\n      } else {\r\n        throw `Delegation with id ${newRepresentedId} not found.`;\r\n      }\r\n    } else {\r\n      return this.httpBackend.execute({\r\n        method: 'POST',\r\n        url: this.authUrls.getChangeDelegationUrl(),\r\n        headers: {\r\n          'Content-type': 'application/json; charset=UTF-8'\r\n        },\r\n        // data: `newDelegationId=${newRepresentedId}`\r\n        data: JSON.stringify({\r\n          newRepresentedId: newRepresentedId\r\n        })\r\n      });\r\n    }\r\n\r\n    // what if this fails????\r\n  }\r\n\r\n  restartApplication() {\r\n    window.location.reload();\r\n  }\r\n\r\n  public handleAjaxRequest(xhr: XHRRequest) {\r\n    HttpHandler.handleAjaxRequest(this.user, xhr);\r\n  }\r\n\r\n  /**\r\n\t * @deprecated use HttpHandler.handleAjaxResponse instead\r\n\t *\r\n\t */\r\n  public handleAjaxResponse(xhr: XHRResponse) {\r\n    HttpHandler.handleAjaxResponse(this.egovAuthOptions, xhr);\r\n  }\r\n\r\n  private _redirect(url: string) {\r\n    window.location.href = url;\r\n  }\r\n\r\n  private _retrieveCurrentWindowUrl(): string {\r\n    return window.location.href;\r\n  }\r\n\r\n  private _isNullOrUndefined(obj: any): boolean {\r\n    return obj === null || typeof obj === 'undefined';\r\n  }\r\n}\r\n","import { AuthenticationUrls } from './authenticationUrls';\r\nimport { User } from './user';\r\nimport { EgovAuthConfiguration } from './egovAuthConfiguration.interface';\r\nimport { XHRResponse, XHRRequest } from './models/xhr';\r\nimport { UIService } from './ui.service';\r\n\r\nexport class HttpHandler {\r\n  private static REDIRECTURL_PLACEHOLDER: string = '{URLENCODED_TARGET}';\r\n\r\n  public static handleAjaxRequest(user: User, xhr: XHRRequest) {\r\n    if (!xhr) {\r\n      throw 'You have to pass in a valid XHR object.';\r\n    }\r\n\r\n    if (user.sessionInfo && user.sessionInfo.currentRepresentedId) {\r\n      xhr.setRequestHeader('client-currentRepresentedId', user.sessionInfo.currentRepresentedId);\r\n    }\r\n\r\n    if (user && user.language) {\r\n      xhr.setRequestHeader('current-language', user.language);\r\n    }\r\n  }\r\n\r\n  public static handleAjaxResponse(egovAuthOptions: EgovAuthConfiguration, xhr: XHRResponse) {\r\n    if (!xhr) {\r\n      throw 'You have to pass in a valid XHR object.';\r\n    }\r\n\r\n    if (this._isNullOrUndefined(xhr.status)) {\r\n      throw 'You have to pass in a valid XHR object having a status property.';\r\n    }\r\n\r\n    if (this._isNullOrUndefined(xhr.url)) {\r\n      throw 'You have to pass in a valid XHR object having a url property containing the request Url.';\r\n    }\r\n\r\n    if (!xhr.getResponseHeader && typeof xhr.getResponseHeader === 'function') {\r\n      throw 'You have to pass in a valid XHR object having a getResponseHeader(key) function.';\r\n    }\r\n\r\n    if (!xhr.getResponseBody && typeof xhr.getResponseBody === 'function') {\r\n      throw 'You have to pass in a valid XHR object having a getResponseBody() function.';\r\n    }\r\n\r\n    if (xhr.status === 401 || xhr.status === 403) {\r\n      /*\r\n\t\t\t\tIf we are in here and the response came from the authentication library\r\n\t\t\t\twe should have received a response object of the following form:\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcode: string;\r\n\t\t\t\t\t\tredirectUrl: string;\r\n\t\t\t\t\t\tmessage: string;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\twhere the `code` property can be of the following:\r\n\t\t\t\t\t- PROFILE_INCOMPLETE\r\n\t\t\t\t\t- DELEGATION_NOT_VALID\r\n\t\t\t\t\t- AUTH_TYPE_NOT_SUPPORTED\r\n\t\t\t*/\r\n\r\n      const responseBody = xhr.getResponseBody();\r\n      if (responseBody && responseBody.redirectUrl) {\r\n        let redirectUrl = responseBody.redirectUrl;\r\n        if (redirectUrl.includes(this.REDIRECTURL_PLACEHOLDER)) {\r\n          redirectUrl = redirectUrl.replace(\r\n            this.REDIRECTURL_PLACEHOLDER,\r\n            encodeURIComponent(this._retrieveCurrentWindowUrl())\r\n          );\r\n        }\r\n\r\n        if (responseBody.message && responseBody.message !== '') {\r\n          if (egovAuthOptions.callbacks && egovAuthOptions.callbacks.notifyUser) {\r\n            egovAuthOptions.callbacks.notifyUser(responseBody);\r\n          } else {\r\n            console.warn(\r\n              'Missing callbacks: { notifyUser: (options) => { ... } } function. You should inform the user about what is going on! (redirecting silently..)'\r\n            );\r\n\r\n            this._redirect(redirectUrl);\r\n          }\r\n        } else {\r\n          this._redirect(redirectUrl);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private static _redirect(url: string) {\r\n    window.location.href = url;\r\n  }\r\n\r\n  private static _retrieveCurrentWindowUrl(): string {\r\n    return window.location.href;\r\n  }\r\n\r\n  private static _isNullOrUndefined(obj: any): boolean {\r\n    return obj === null || typeof obj === 'undefined';\r\n  }\r\n}\r\n","import { Delegation } from './models/delegation';\r\nimport { EgovAuthConfiguration } from './egovAuthConfiguration.interface';\r\nimport { User } from './user';\r\nimport { translate, AuthLanguageCode } from './localizations';\r\n\r\nexport class UIService {\r\n    private lang:AuthLanguageCode;\r\n\r\n    constructor(private user:User, egovAuthOptions:EgovAuthConfiguration) {\r\n\r\n        // calculate the language to be used\r\n        let lang:AuthLanguageCode = 'de';\r\n        if(egovAuthOptions.language) {\r\n\t\t\tlang = egovAuthOptions.language;\r\n\t\t} else if(user && user.language) {\r\n\t\t\tlang = user.language;\r\n\t\t} \r\n        this.lang = lang;\r\n    }\r\n\r\n    getCurrentLang() : AuthLanguageCode {\r\n        return this.lang;\r\n    }\r\n\r\n    translate(key): string {\r\n        return translate(this.lang, key);\r\n    }\r\n\r\n    resolveDelegationLinkText(delegation:Delegation): string {\r\n        const represented = delegation.represented;\r\n\r\n        if (represented.id === this.user.owner.id) {\r\n            return translate(this.lang, 'WorkForMe');\r\n        } else if (represented.naturalPerson) {\r\n            return `${represented.naturalPerson.firstname} ${represented.naturalPerson.lastname}`;\r\n        } else if (represented.juristicPerson) {\r\n            return this.returnLocalized(\r\n                    represented.juristicPerson.nameDe,\r\n                    represented.juristicPerson.nameIt);\r\n        }\r\n\r\n\t\treturn '(unable to determine link text)';\r\n    }\r\n\r\n    resolveDelegationDisplayName(): string {\r\n        let activeDelegation = this.user.activeDelegation;\r\n        if (activeDelegation) {\r\n            return this.resolveDelegationLinkText(activeDelegation);\r\n        }\r\n\r\n\t\treturn '(unable to determine delegation name)';\r\n    }\r\n\r\n    ellipsis(text: string, maxLength: number): string {\r\n        if (text) {\r\n            if (typeof maxLength === 'undefined') {\r\n                maxLength = 9000; //a large number\r\n            }\r\n\r\n            if (text.length <= maxLength)\r\n                return text;\r\n\r\n            var xMaxFit = maxLength - 3;\r\n            var xTruncateAt = text.lastIndexOf(' ', xMaxFit);\r\n            if (xTruncateAt == -1 || xTruncateAt < maxLength / 2)\r\n                xTruncateAt = xMaxFit;\r\n\r\n            return text.substr(0, xTruncateAt) + \"...\";\r\n        } else {\r\n            return text;\r\n        }\r\n    }\r\n\r\n    public returnLocalized(german: string, italian: string = german, english: string = german): string {\r\n        if (this.lang.toUpperCase() === 'IT') {\r\n            return italian;\r\n        } else if (this.lang.toUpperCase() === 'EN') {\r\n            return english;\r\n        } else {\r\n            return german;\r\n        }\r\n    }\r\n\r\n}\r\n","\r\nvar localizationTable = {\r\n    en: {\r\n        \"My Profile\": \"My Profile\",\r\n        \"AccessData\": \"Account Credentials\",\r\n        \"Delegations\": \"Delegations\",\r\n        \"MyRepresentatives\":\"Representatives\",\r\n        \"Work for someone else\": \"Work for someone else\",\r\n        \"DelegationNotAvailableInService\": \"not available for this service\",\r\n        \"NoDelegations\": \"you don't have any delegations\",\r\n        \"NewDelegationLinkText\": \"New Delegation\",\r\n\t\t\"WorkForMe\": \"Work for me\",\r\n\t\t\"wordFor\": \"on behalf of\",\r\n\t\t\"PossibleDelegations\": \"Possible Delegations\"\r\n    },\r\n\r\n    de: {\r\n        \"My Profile\": \"Mein Profil\",\r\n\t\t\"AccessData\": \"Zugangsdaten\",\r\n        \"Delegations\": \"Vertretungen\",\r\n        \"MyRepresentatives\":\"Vertreter\",\r\n        \"Work for someone else\": \"Für jemand anderen arbeiten\",\r\n        \"DelegationNotAvailableInService\": \"für diesen Dienst nicht verfügbar\",\r\n        \"NoDelegations\": \"Sie haben keine Vertretungen\",\r\n        \"NewDelegationLinkText\": \"Neue Vertretung beantragen\",\r\n\t\t\"WorkForMe\": \"Für mich arbeiten\",\r\n\t\t\"wordFor\": \"im Namen von\",\r\n\t\t\"PossibleDelegations\": \"Mögliche Vertretungen\"\r\n    },\r\n\r\n    it: {\r\n        \"My Profile\": \"Mio profilo\",\r\n\t\t\"AccessData\": \"Dati d'accesso\",\r\n        \"Delegations\": \"Deleghe\",\r\n        \"MyRepresentatives\":\"Rappresentanti\",\r\n        \"Work for someone else\": \"Lavorare per qualcun altro\",\r\n        \"DelegationNotAvailableInService\": \"non disponibile per questo servizio\",\r\n        \"NoDelegations\": \"non ha ancora nessuna delega\",\r\n        \"NewDelegationLinkText\": \"Richiesta nuova delega\",\r\n\t\t\"WorkForMe\": \"Lavorare per me stesso\",\r\n\t\t\"wordFor\": \"a nome di\",\r\n\t\t\"PossibleDelegations\": \"Deleghe possibili\"\r\n    }\r\n};\r\n\r\nexport function translate(lang: AuthLanguageCode, key) {\r\n\tlet language = lang.toLowerCase();\r\n    return localizationTable[language][key] || '[' + key + ']';\r\n}\r\n\r\nexport type AuthLanguageCode = 'de' | 'it' | 'en';\r\n","/** IE9, IE10 and IE11 requires all of the following polyfills. **/\r\n// import 'core-js/es6/symbol';\r\nimport 'core-js/es6/object';\r\n// import 'core-js/es6/function';\r\n// import 'core-js/es6/parse-int';\r\n// import 'core-js/es6/parse-float';\r\n// import 'core-js/es6/number';\r\n// import 'core-js/es6/math';\r\n// import 'core-js/es6/string';\r\n// import 'core-js/es6/date';\r\n// import 'core-js/es6/array';\r\n// import 'core-js/es6/regexp';\r\n// import 'core-js/es6/map';\r\n// import 'core-js/es6/weak-map';\r\n// import 'core-js/es6/set';\r\n\r\n// evergreen browsers need this\r\n// import 'core-js/es6/reflect';\r\n// import 'core-js/es7/reflect';\r\n"],"names":[],"mappings":"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"}